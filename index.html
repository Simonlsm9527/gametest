<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Link in City</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #181d29 url('assetsHUB/imagesHUB/bgHUB.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Segoe UI', Arial, 'Microsoft YaHei', sans-serif;
      color: #dafcfb;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      width: 100vw;
      padding: 2rem 1rem;
      position: absolute;
      top: 0; left: 0;
      background: rgba(24,29,41,0.97);
      z-index: 1;
    }
    .active {
      display: flex !important;
      z-index: 10;
    }
    h1, h2, h3 {
      margin: 0 0;
      font-weight: 700;
      letter-spacing: 0px;
      text-align: center;
    }
    .game-title {
      font-size: 2.4rem;
      margin-bottom: 2rem;
      color: #5dffe5;
      text-shadow: 0 4px 12px #003a4e88;
    }
    button {
      padding: 0.9em 2.2em;
      margin: 1.1em 0.5em 0 0.5em;
      border: none;
      border-radius: 0.7em;
      background: linear-gradient(90deg, #38c6c6 60%, #55ffe0 100%);
      color: #114;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 3px 12px #003a4e55;
      position: relative;
      outline: none;
    }
    button:active, button:hover {
      background: linear-gradient(90deg, #55ffe0 30%, #38c6c6 100%);
      color: #083;
      box-shadow: 0 6px 16px #00ffc944;
    }
    .level-link-btn.locked {
      background: #3a444a;
      color: #888 !important;
      cursor: not-allowed;
      opacity: 0.7;
      pointer-events: auto;
    }
    .level-link-btn.locked::after {
      content: '';
      display: inline-block;
      vertical-align: middle;
      margin-left: 8px;
      width: 22px;
      height: 22px;
      background: url('assetsHUB/imagesHUB/lockHUB.png') no-repeat center/contain;
    }
    .game-container {
      width: 100vw;
      max-width: 800px;
      height: 600px;
      margin: 0 auto 2em;
      border: 3px dashed #5dffe588;
      border-radius: 1.2em;
      background: #20243acc;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
      transition: box-shadow 0.18s;
      box-shadow: 0 6px 40px #002e3e77;
    }
    .game-frame {
      width: 100%;
      height: 100%;
      border: none;
      margin: 0;
      padding: 0;
      display: block;
      background: transparent;
      overflow: hidden;
      scrollbar-width: none;
    }
    .header {
      font-size: 1.7em;
      margin-bottom: 0.7em;
      color: #fff;
      letter-spacing: 1px;
      text-shadow: 0 2px 10px #5dffe566;
    }
    .asset-demo {
      width: 70px; height: 70px;
      margin: 1.4em auto 0 auto;
      display: block;
      border-radius: 50%;
      border: 2px solid #fff;
      object-fit: cover;
      background: #222;
    }
    .level-list {
      display: flex;
      flex-direction: column;
      gap: 1em;
      margin-top: 1em;
    }

    /* -------------------------- Transition Screens 样式 -------------------------- */
.transition-section {
  background: rgba(15,20,30,0.96) url('assetsHUB/imagesHUB/bgTransition.jpg') no-repeat center center / cover;
  border: 3px solid #5dffe5;
  border-radius: 1.5em;
  width: 90vw;               /* ←改 */
  max-width: 800px;          /* ←加 */
  height: 70vw;              /* ←改 */
  max-height: 600px;         /* ←加 */
  min-width: 280px;          /* ←加，防止过小 */
  min-height: 320px;         /* ←加，防止过小 */
  margin: 0 auto;
  padding: 2.2em 1.5em 2.8em 1.5em;
  box-shadow: 0 8px 32px #002e3e88;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  position: relative;
  box-sizing: border-box;
}
    .transition-section h2 {
      max-width: 800px;
      width: 100%;
      margin: auto; /* 修改为auto实现垂直居中 */
      font-size: 1.8em;
      line-height: 70px;
      font-style: italic;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      color: #64fff9;
      letter-spacing: 2px;
      text-align: center;
      background: rgba(0,30,60,0.06);
      padding: 0.7em 0.7em;
      border-radius: 0.7em;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1; /* 添加flex属性使其占据可用空间 */
      box-sizing: border-box;
    }
    .transition-section .btn-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 2em; /* 增加与文字的距离 */
      padding-bottom: 1em; /* 底部留白 */
    }
    .transition-section .next-level-btn,
    .transition-section #finish-btn,
    .transition-section .start-level-btn {
      display: block;
      margin: 0 auto; /* 水平居中 */
      font-size: 1.25em;
      color: #181d29;
      background: linear-gradient(90deg, #5dffe5 0%, #38c6c6 100%);
      border-radius: 0.5em;
      box-shadow: 0 3px 12px #003a4e88;
      min-width: 200px;
      min-height: 48px;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .transition-section .next-level-btn:active,
    .transition-section .next-level-btn:hover,
    .transition-section #finish-btn:active,
    .transition-section #finish-btn:hover,
    .transition-section .start-level-btn:active,
    .transition-section .start-level-btn:hover {
      background: linear-gradient(90deg, #38c6c6 0%, #5dffe5 100%);
      color: #083;
    }

    /* -------------------------- Start Screen 样式 -------------------------- */
    #start-screen {
      background: url('assetsHUB/imagesHUB/bgStart.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
      border: 0px solid #38c6c6;
      border-radius: 1.4em;
      box-shadow: 0 10px 40px #00d0ff55;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #start-screen .game-title {
      color: #38c6c6;
      font-size: 2.7em;
      letter-spacing: 2px;
      text-shadow: 0 4px 20px #003a4e66;
    }
    #start-btn {
      background: linear-gradient(90deg, #5dffe5 0%, #38c6c6 100%);
      color: #181d29;
      font-size: 1.3em;
      border-radius: 0.7em;
      min-width: 220px;
      min-height: 52px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 4px 18px #003a4e66;
    }
    #start-btn:active, #start-btn:hover {
      background: linear-gradient(90deg, #38c6c6 0%, #5dffe5 100%);
      color: #083;
    }

    /* -------------------------- Hub/Main Menu 样式 -------------------------- */
    #hub-screen {
      background: url('assetsHUB/imagesHUB/bgHub.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
      border: 0px solid #5dffe5;
      border-radius: 1.3em;
      box-shadow: 0 8px 32px #02ffe055;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #hub-screen .game-title {
      color: #5dffe5;
      font-size: 2.3em;
      letter-spacing: 1.5px;
      text-shadow: 0 4px 12px #003a4e88;
    }
    #hub-screen .level-list .level-link-btn {
      background: linear-gradient(90deg, #38c6c6 70%, #e6ff55 100%);
      color: #181d29;
      font-size: 1.17em;
      border-radius: 0.7em;
      min-width: 230px;
      min-height: 50px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 3px 12px #003a4e44;
    }
    #hub-screen .level-list .level-link-btn:active,
    #hub-screen .level-list .level-link-btn:hover {
      background: linear-gradient(90deg, #e6ff55 40%, #38c6c6 100%);
      color: #5dffe5;
    }

    /* -------------------------- Level Screens 样式 -------------------------- */
    #level1-screen {
      background: url('assetsHUB/imagesHUB/bgLevel1.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
    }
    #level1-screen .game-container {
      border: 3px solid #ff6f91;
      box-shadow: 0 4px 24px #ff6f9155;
    }
    #level1-screen .header {
      color: #ff6f91;
      font-size: 2em;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #level1-screen .exit-btn {
      background: linear-gradient(90deg, #ffb385 0%, #ff6f91 100%);
      color: #fff;
      font-size: 1.18em;
      border-radius: 0.6em;
      min-width: 180px;
      min-height: 45px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 2px 8px #ff6f9144;
    }
    #level1-screen .exit-btn:active, #level1-screen .exit-btn:hover {
      background: linear-gradient(90deg, #ff6f91 0%, #ffb385 100%);
      color: #ff6f91;
    }

    #level2-screen {
      background: url('assetsHUB/imagesHUB/bgLevel2.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
    }
    #level2-screen .game-container {
      border: 3px solid #b2ed17;
      box-shadow: 0 4px 24px #6a9309;
    }
    #level2-screen .header {
      color: #b2ed17;
      font-size: 2em;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #level2-screen .exit-btn {
      background: linear-gradient(90deg, #b2ed17 0%, #6a9309 100%);
      color: #fff;
      font-size: 1.18em;
      border-radius: 0.6em;
      min-width: 180px;
      min-height: 45px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 2px 8px #6a9309;
    }
    #level2-screen .exit-btn:active, #level2-screen .exit-btn:hover {
      background: linear-gradient(90deg, #6a9309 0%, #b2ed17 100%);
      color: #b2ed17;
    }

    #level3-screen {
      background: url('assetsHUB/imagesHUB/bgLevel3.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
    }
    #level3-screen .game-container {
      border: 3px solid #ffc857;
      box-shadow: 0 4px 24px #ffc85755;
    }
    #level3-screen .header {
      color: #ffc857;
      font-size: 2em;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #level3-screen .exit-btn {
      background: linear-gradient(90deg, #ffc857 0%, #ffb385 100%);
      color: #222;
      font-size: 1.18em;
      border-radius: 0.6em;
      min-width: 180px;
      min-height: 45px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 2px 8px #ffc85744;
    }
    #level3-screen .exit-btn:active, #level3-screen .exit-btn:hover {
      background: linear-gradient(90deg, #ffb385 0%, #ffc857 100%);
      color: #ffc857;
    }

    #level4-screen {
      background: url('assetsHUB/imagesHUB/bgLevel4.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
    }
    #level4-screen .game-container {
      border: 3px solid #70d9ff;
      box-shadow: 0 4px 24px #44859c;
    }
    #level4-screen .header {
      color: #70d9ff;
      font-size: 2em;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }
    #level4-screen .exit-btn {
      background: linear-gradient(90deg, #70d9ff 0%, #44859c 100%);
      color: #222;
      font-size: 1.18em;
      border-radius: 0.6em;
      min-width: 180px;
      min-height: 45px;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: 0 2px 8px #44859c;
    }
    #level4-screen .exit-btn:active, #level4-screen .exit-btn:hover {
      background: linear-gradient(90deg, #44859c 0%, #70d9ff 100%);
      color: #70d9ff;
    }

    /* 通用 Trophy、最终界面等统一色调 */
    #dino-complete-screen, #final-screen {
      background: url('assetsHUB/imagesHUB/bgFinal.jpg') no-repeat center center fixed, rgba(24,29,41,0.97);
      background-size: cover;
    }

/* 确保dino-complete-screen有相对定位 */
#dino-complete-screen {
  position: relative;
  z-index: 10;
}

/* 右下角文字样式 */
.footer-note {
  position: absolute;
  bottom: 20px;
  right: 20px;
  text-align: right;
  font-size: 0.8rem;
  color: #e6fffa;
  line-height: 1.4;
  z-index: 100;
  pointer-events: none;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

.footer-note p {
  margin: 0;
  padding: 0;
}

/* 外部链接按钮样式 */
#external-link-btn {
    background: linear-gradient(90deg, #000000 0%, #7a7a7a 100%);
    color: #fff;
    box-shadow: 0 3px 12px rgba(255, 255, 255, 0.4);
}
#external-link-btn:hover, #external-link-btn:active {
    background: linear-gradient(90deg, #7a7a7a 0%, #000000 100%);
    color: #ffffff;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
}

/* 按钮容器样式 */
.dino-buttons-container {
    display: flex;
    gap: 20px;
    margin-top: 25px;
    flex-wrap: wrap;
    justify-content: center;
}

.instruction-text {
  font-size: 1rem;
  color: #dafcfb;
  margin: 0.5rem 0 1.5rem 0;
  text-align: center;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
  letter-spacing: 0.5px;
}

/* 响应式调整 */
@media (max-width: 600px) {
    .dino-buttons-container {
        flex-direction: column;
        gap: 15px;
    }
}

/* 响应式调整 */
@media (max-width: 900px) {
  .footer-note {
    font-size: 0.75rem;
    bottom: 15px;
    right: 15px;
  }
}

@media (max-width: 600px) {
  .footer-note {
    font-size: 0.7rem;
    bottom: 10px;
    right: 10px;
    line-height: 1.3;
  }
}

/* 响应式调整 */
@media (max-width: 900px) {
  .footer-note {
    font-size: 0.75rem;
    bottom: 15px;
    right: 15px;
  }
}

@media (max-width: 600px) {
  .footer-note {
    font-size: 0.7rem;
    bottom: 10px;
    right: 10px;
    line-height: 1.3;
  }
}

    /* 响应式调整 */
    @media (max-width: 900px) {
      .footer-note {
        font-size: 0.75rem;
        bottom: 15px;
        right: 15px;
      }
    }

    @media (max-width: 600px) {
      .footer-note {
        font-size: 0.7rem;
        bottom: 10px;
        right: 10px;
        line-height: 1.3;
      }
    }

    /* 原有的媒体查询保持不变 */
    @media (max-width: 900px) {
      .game-container {
        width: 100vw;
        height: 72vw;
        min-width: 320px;
        min-height: 180px;
        max-width: 100vw;
        max-height: 80vw;
        border-radius: 0;
      }
      /* ... 其他原有样式 ... */
    }
    @media (max-width: 600px) {
      .game-title { font-size: 1.3rem; }
      /* ... 其他原有样式 ... */
    }


    @media (max-width: 900px) {
      .game-container {
        width: 100vw;
        height: 72vw;
        min-width: 320px;
        min-height: 180px;
        max-width: 100vw;
        max-height: 80vw;
        border-radius: 0;
      }
      .game-frame {
        width: 100vw;
        height: 72vw;
        max-width: 100vw;
        max-height: 72vw;
      }
      .screen {
        padding: 1rem 0.2rem;
      }
      .transition-section {
        padding: 1.1em 0.5em 1.6em 0.5em;
        border-radius: 1em;
      }
      .transition-section h2 {
        font-size: 1.1em;
        padding: 0.5em 0.5em;
      }
    }
    @media (max-width: 600px) {
      .game-title { font-size: 1.3rem; }
      .header { font-size: 1.05rem; }
      .asset-demo { width: 46px; height: 46px;}
      button { font-size: 1em; padding: 0.7em 1.2em;}
      .transition-section h2 { font-size: 1em; }
      #start-screen .game-title, #hub-screen .game-title { font-size: 1.2rem; }
      #start-btn, #hub-screen .level-list .level-link-btn { font-size: 1em; min-width: 120px; min-height: 36px;}
      .transition-section .next-level-btn, .transition-section #finish-btn, .transition-section .start-level-btn { font-size: 1em; min-width: 120px; min-height: 36px;}
    }
  
    /* ---------- 新增虚拟键盘样式 ---------- */
.virtual-keys {
  position: relative; /* 改为相对定位 */
  margin: 20px 0; /* 添加上下边距，保持与按钮的距离 */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 999;
  opacity: 0.9;
  touch-action: manipulation;
}
    .virtual-row {
      display: flex;
      justify-content: center;
      margin: 4px 0;
    }
.virtual-key {
  width: 36px; /* 从48px缩小到36px */
  height: 36px; /* 从48px缩小到36px */
  margin: 4px; /* 从6px减小到4px */
  border-radius: 8px; /* 从10px减小到8px */
  background: rgba(255,255,255,0.15);
  color: #fff;
  font-size: 1em; /* 从1.2em减小到1em */
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  user-select: none;
}
    .virtual-key:active {
      background: rgba(255,255,255,0.35);
    }

</style>
</head>
<body>
  <!-- Start Screen -->
  <section id="start-screen" class="screen active">
    <h1 class="game-title">Link in City</h1>
      <p class="instruction-text">游戏使用 WASD 操作</p>

    <button id="start-btn">开始漫步</button>
  </section>

  <!-- 新增 Start to Level1 Transition Screen -->
  <section id="prelevel1-transition-screen" class="screen">
    <div class="transition-section">
      <h2>商场是消费主义的迷宫<br>
        为了防止迷路<br>
        请追随“想你的风”<br>
      </h2>
      <div class="btn-container">
        <button class="start-level-btn" id="start-level1-btn">开始第1关</button>
      </div>
    </div>
  </section>

  <!-- Hub/Main Menu -->
  <section id="hub-screen" class="screen">
    <h1 class="game-title">Link in City</h1>
    <p style="margin-bottom:1.2em;">
      请选择目的地开始漫步<br>
      <br>
      游戏使用 WASD 操作<br>
    </p>
    <div class="level-list">
      <button class="level-link-btn" data-level="1">Level 1：华旺发时尚商城</button>
      <button class="level-link-btn" data-level="2">Level 2：奠基大道中</button>
      <button class="level-link-btn" data-level="3">Level 3：丰施街区</button>
      <button class="level-link-btn" data-level="4">Level 4：缤纷活力大铁柱</button>
    </div>
  </section>

  <!-- Level Screens -->
  <section id="level1-screen" class="screen">
    <div class="header">Level 1：华旺发时尚商城</div>
    <div class="game-container">
      <iframe class="game-frame" src="maze_game/maze_game00.html" allowfullscreen></iframe>
    </div>
    <button class="exit-btn" data-exit-level="1">返回目的地选择</button>
  </section>
  <section id="level2-screen" class="screen">
    <div class="header">Level 2：奠基大道中</div>
    <div class="game-container">
      <iframe class="game-frame" src="crossroad_game/crossroad_game00.html" allowfullscreen></iframe>
    </div>
    <button class="exit-btn" data-exit-level="2">返回目的地选择</button>
  </section>
  <section id="level3-screen" class="screen">
    <div class="header">Level 3：丰施街区</div>
    <div class="game-container">
      <iframe class="game-frame" src="landmine_game/landmine_game00.html" allowfullscreen></iframe>
    </div>
     <div class="instruction-text">鼠标：左键/右键，触屏：短按/长按</div>
    <button class="exit-btn" data-exit-level="3">返回目的地选择</button>
  </section>
  <section id="level4-screen" class="screen">
    <div class="header">Level 4：缤纷活力大铁柱</div>
    <div class="game-container">
      <iframe class="game-frame" src="dino_runner_game/dino_runner_game00.html" allowfullscreen></iframe>
    </div>
    <button class="exit-btn" data-exit-level="4">返回目的地选择</button>
  </section>

  <!-- 通关 Transition Screens -->
  <section id="transition1-screen" class="screen">
    <div class="transition-section">
      <h2>城市鼓励所有人以25km/h的速度移动<br>
        但不允许任何人停留<br>
      </h2>
      <div class="btn-container">
        <button class="next-level-btn" data-next="2">进入下一关</button>
      </div>
    </div>
  </section>
  <section id="transition2-screen" class="screen">
    <div class="transition-section">
      <h2>由于街区太潮<br>
        请来打卡集章的潮人们<br>
        小心毒蘑菇<br>
      </h2>
      <div class="btn-container">
        <button class="next-level-btn" data-next="3">进入下一关</button>
      </div>
    </div>
  </section>
  <section id="transition3-screen" class="screen">
    <div class="transition-section">
      <h2>大铁柱在城市上空闪耀<br>
        无论是石墩子还是行人<br>
        都能投下彩色的影子<br>
      </h2>
      <div class="btn-container">
        <button class="next-level-btn" data-next="4">进入下一关</button>
      </div>
    </div>
  </section>
  <section id="transition4-screen" class="screen">
    <div class="transition-section">
      <h2>全部关卡完成！</h2>
      <div class="btn-container">
        <button id="finish-btn">完成</button>
      </div>
    </div>
  </section>

<!-- 恐龙酷跑通关界面 -->
<section id="dino-complete-screen" class="screen">
  <h2>恭喜！你已完成本次城市漫游！</h2>
  
  <!-- 新增右下角文字 -->
  <div class="footer-note">
    <p>创意：林克计划</p>
    <p>美术：智谱清言智能体</p>
    <p>编程：ChatGPT-4.1 / Deepseek</p>
    <p>音乐由[乌鸦Producer]提供</p>
  </div>
  
  <!-- 修改按钮容器 -->
  <div class="dino-buttons-container">
    <button id="dino-complete-btn">返回目的地选择</button>
    <button id="external-link-btn">了解林克计划</button>
  </div>
</section>

  <!-- Final Screen -->
 <section id="final-screen" class="screen">
  <h2>恭喜！你已完成城市漫游！</h2>
  
  
  <!-- 确保这里添加了footer-note -->
  <div class="footer-note">
    <p>创意：林克计划</p>
    <p>美术：智谱清言智能体</p>
    <p>音乐：B站@乌鸦Producer</p>
    <p>编程：ChatGPT-4.1 / Deepseek</p>
  </div>
  
  <button id="restart-btn">重新开始</button>
</section>

  <!-- 音效资源（全部本地文件，HUB 特征码） -->
  <!-- 按钮按动音效 -->
  <audio id="sfx-clickHUB" src="assetsHUB/soundHUB/clickHUB.wav" preload="auto"></audio>
  <audio id="sfx-lockedHUB" src="assetsHUB/soundHUB/lockedHUB.wav" preload="auto"></audio>
  <audio id="sfx-levelUnlockHUB" src="assetsHUB/soundHUB/level_unlockHUB.wav" preload="auto"></audio>
  <audio id="sfx-completeHUB" src="assetsHUB/soundHUB/completeHUB.wav" preload="auto"></audio>
  <audio id="sfx-failHUB" src="assetsHUB/soundHUB/failHUB.wav" preload="auto"></audio>
  <!-- 四个关卡背景音乐（可被替换），进入关卡时播放，离开或切换时暂停 -->
  <audio id="bgm-level1-HUB" src="assetsHUB/soundHUB/bgm_level1HUB.mp3" preload="auto" loop></audio>
  <audio id="bgm-level2-HUB" src="assetsHUB/soundHUB/bgm_level2HUB.mp3" preload="auto" loop></audio>
  <audio id="bgm-level3-HUB" src="assetsHUB/soundHUB/bgm_level3HUB.mp3" preload="auto" loop></audio>
  <audio id="bgm-level4-HUB" src="assetsHUB/soundHUB/bgm_level4HUB.mp3" preload="auto" loop></audio>

  <script>
    // -------------------------- 关卡状态 --------------------------
    let unlockedLevel = 1;
    let currentLevel = 1;
    function updateLevelButtons() {
      document.querySelectorAll('.level-link-btn').forEach(btn => {
        const level = parseInt(btn.dataset.level, 10);
        btn.disabled = (level > unlockedLevel);
        btn.classList.toggle('locked', level > unlockedLevel);
      });
    }
    updateLevelButtons();

    // -------------------------- 路由系统 --------------------------
    const screens = [
      "start-screen", "prelevel1-transition-screen", "hub-screen",
      "level1-screen", "level2-screen", "level3-screen", "level4-screen",
      "transition1-screen", "transition2-screen", "transition3-screen", "transition4-screen",
      "dino-complete-screen", "final-screen"
    ];
    function showScreen(id) {
      screens.forEach(s => document.getElementById(s).classList.remove('active'));
      document.getElementById(id).classList.add('active');
      window.scrollTo(0, 0);
      playSFX('click00');
    }

    // -------------------------- 音效播放 --------------------------
    function playSFX(name) {const idMap = {
        'click00': 'sfx-clickHUB',
        'locked00': 'sfx-lockedHUB',
        'level_unlock00': 'sfx-levelUnlockHUB',
        'complete00': 'sfx-completeHUB',
        'fail00': 'sfx-failHUB'
      };
      const id = idMap[name] || name;
      const audio = document.getElementById(id);
      if (audio) { try { audio.currentTime = 0; audio.play(); } catch(e) {} }
    }

    function stopAllBGM() {
      ['bgm-level1-HUB','bgm-level2-HUB','bgm-level3-HUB','bgm-level4-HUB'].forEach(id => {
        const a = document.getElementById(id);
        if (a) { try { a.pause(); a.currentTime = 0; } catch(e) {} }
      });
    }
    function playLevelBGM(level) {
      stopAllBGM();
      const a = document.getElementById(`bgm-level${level}-HUB`);
      if (a) { try { a.play(); } catch(e) {} }
    }

    // -------------------------- 事件绑定 --------------------------
    // 启动按钮
    document.getElementById('start-btn').onclick = () => {
      showScreen('prelevel1-transition-screen');
      stopAllBGM();
    };

    // 新增：prelevel1-transition-screen的"开始第1关"按钮
    document.getElementById('start-level1-btn').onclick = () => {
      currentLevel = 1;
      showScreen('level1-screen');
      playLevelBGM(1);
    };

    // 外部链接按钮
document.getElementById('external-link-btn').onclick = () => {
  window.open('https://link-project.notion.site/Hey-I-m-LINK-23418d9dc3c580fe8b93fc557d659ffc', '_blank'); // 请将URL替换为实际需要的网址
};

    // 关卡按钮锁定与解锁
    document.querySelectorAll('.level-link-btn').forEach(btn => {
      btn.onclick = (e) => {
        const level = parseInt(btn.dataset.level, 10);
        if (level > unlockedLevel) {
          playSFX('locked00');
          return;
        }
        currentLevel = level;

        // 特殊处理第四关：重新加载iframe以重置游戏状态
        if (level === 4) {
          const iframe = document.querySelector('#level4-screen .game-frame');
          if (iframe) {
            iframe.src = iframe.src; // 重新加载iframe
          }
        }

        showScreen(`level${currentLevel}-screen`);
        playLevelBGM(currentLevel);
      };
    });

    // 返回关卡选择
    document.querySelectorAll('.exit-btn').forEach(btn => {
      btn.onclick = e => {
        showScreen('hub-screen');
        stopAllBGM();
      };
    });

    // 下一关跳转
    document.querySelectorAll('.next-level-btn').forEach(btn => {
      btn.onclick = () => {
        const next = parseInt(btn.dataset.next, 10);
        currentLevel = next;

        // 特殊处理第四关：重新加载iframe以重置游戏状态
        if (next === 4) {
          const iframe = document.querySelector('#level4-screen .game-frame');
          if (iframe) {
            iframe.src = iframe.src; // 重新加载iframe
          }
        }

        showScreen(`level${next}-screen`);
        playLevelBGM(next);
      };
    });

    // 完成
    document.getElementById('finish-btn').onclick = () => {
      showScreen('final-screen');
      stopAllBGM();
    };
    // 恐龙酷跑通关按钮
    document.getElementById('dino-complete-btn').onclick = () => {
      showScreen('hub-screen');
      stopAllBGM();
    };
    // 重新开始
    document.getElementById('restart-btn').onclick = () => {
      unlockedLevel = 1;
      localStorage.setItem('unlockedLevel00', unlockedLevel);
      updateLevelButtons();
      showScreen('start-screen');
      stopAllBGM();
    };

    // ----------------------- 子游戏通关通信 -----------------------
    function unlockLevel(level) {
      if (level > unlockedLevel) {
        unlockedLevel = level;
        localStorage.setItem('unlockedLevel00', unlockedLevel);
        updateLevelButtons();
        playSFX('level_unlock00');
      }
    }
    window.addEventListener('message', function(e) {
      if (e.data === 'goto-level-2') {
        unlockLevel(2);
        showScreen('transition1-screen');
        stopAllBGM();
      }
      if (e.data === 'goto-level-3') {
        unlockLevel(3);
        showScreen('transition2-screen');
        stopAllBGM();
      }
      if (e.data === 'goto-level-4') {
        unlockLevel(4);
        showScreen('transition3-screen');
        stopAllBGM();
      }
      if (e.data === 'goto-hub-finish') {
        showScreen('transition4-screen');
        stopAllBGM();
      }
      if (e.data === 'dino-complete') {
        playSFX('complete00');
        showScreen('dino-complete-screen');
        stopAllBGM();
      }
    });

    // ----------------------- 页面初始化 -----------------------
    window.addEventListener('DOMContentLoaded', () => {
      // 每次打开网页时重置游戏进度，从第一关开始
      unlockedLevel = 1;
      currentLevel = 1;
      localStorage.setItem('unlockedLevel00', unlockedLevel);
      updateLevelButtons();
      showScreen('start-screen');
      stopAllBGM();
    });
  
    // ----------------------- 新增：移动端虚拟WASD键盘 -----------------------
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function createVirtualKeyboard(container) {
      const wrap = document.createElement('div');
      wrap.className = 'virtual-keys';
      wrap.innerHTML = `
        <div class="virtual-row"><div class="virtual-key" data-key="w">W</div></div>
        <div class="virtual-row">
          <div class="virtual-key" data-key="a">A</div>
          <div class="virtual-key" data-key="s">S</div>
          <div class="virtual-key" data-key="d">D</div>
        </div>
      `;
      container.appendChild(wrap);
      wrap.querySelectorAll('.virtual-key').forEach(key => {
        key.addEventListener('touchstart', e => {
          e.preventDefault();
          sendKey(key.dataset.key, true);
        });
        key.addEventListener('touchend', e => {
          e.preventDefault();
          sendKey(key.dataset.key, false);
        });
      });
    }

    function sendKey(key, isDown) {
      const type = isDown ? 'keydown' : 'keyup';
      const evt = new KeyboardEvent(type, { key, bubbles: true });
      document.dispatchEvent(evt);
      document.querySelectorAll('.game-frame').forEach(frame => {
        try {
          frame.contentWindow.dispatchEvent(new KeyboardEvent(type, { key, bubbles: true }));
        } catch(e){}
      });
    }

window.addEventListener('DOMContentLoaded', () => {
  if (isMobile()) {
    ['level1-screen','level2-screen','level4-screen'].forEach(id => {
      const scr = document.getElementById(id);
      if (scr) {
        // 找到.exit-btn的父元素，将虚拟键盘插入到按钮后面
        const exitBtn = scr.querySelector('.exit-btn');
        if (exitBtn && exitBtn.parentElement) {
          createVirtualKeyboard(exitBtn.parentElement);
        }
      }
    });
  }
});

</script>

</body>
</html>